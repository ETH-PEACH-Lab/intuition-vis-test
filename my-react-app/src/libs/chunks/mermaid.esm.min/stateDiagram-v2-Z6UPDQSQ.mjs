import{a as j,b as q,c as K,d as F,e as J,f as G,g as Q,h as N,i as X}from"./chunk-PG3WZFYA.mjs";import{a as z}from"./chunk-MZJD37A6.mjs";import"./chunk-6PBAZYZY.mjs";import"./chunk-4DYLSDN7.mjs";import"./chunk-25QWRKWN.mjs";import"./chunk-M5RPCIO7.mjs";import{a as W}from"./chunk-AUXUJQO7.mjs";import"./chunk-VMDNBU76.mjs";import"./chunk-LEAL3RNQ.mjs";import{m as V,p as w}from"./chunk-JT6TYY6Y.mjs";import"./chunk-EZ6AQD5Z.mjs";import{Ia as Y,Ta as b,b as d,h as y,ha as x}from"./chunk-3RIG7DRU.mjs";import"./chunk-RS46GSJM.mjs";import{a}from"./chunk-J73WXDYM.mjs";var R="rect",L="rectWithTitle",at="start",dt="end",Et="divider",pt="roundedWithTitle",St="note",ft="noteGroup",u="statediagram",Tt="state",ut=`${u}-${Tt}`,I="transition",_t="note",Dt="note-edge",At=`${I} ${Dt}`,bt=`${u}-${_t}`,ht="cluster",gt=`${u}-${ht}`,yt="cluster-alt",xt=`${u}-${yt}`,tt="parent",et="note",Rt="state",O="----",Ct=`${O}${et}`,Z=`${O}${tt}`,ot="fill:none",st="fill: #333",nt="c",it="text",rt="normal",C={},E=0,$t={},wt=a(function(e){let n=Object.keys(e);for(let o of n)$t[o]=e[o]},"setConf"),Gt=a(function(e,n){return n.db.extract(n.db.getRootDocV2()),n.db.getClasses()},"getClasses");function Nt(e){return e==null?"":e.classes?e.classes.join(" "):""}a(Nt,"getClassesFromDbInfo");function m(e="",n=0,o="",i=O){let r=o!==null&&o.length>0?`${i}${o}`:"";return`${Rt}-${e}${r}-${n}`}a(m,"stateDomId");var h=a((e,n,o,i,r,c)=>{let t=o.id,_=Nt(i.get(t));if(t!=="root"){let f=R;o.start===!0&&(f=at),o.start===!1&&(f=dt),o.type!==G&&(f=o.type),C[t]||(C[t]={id:t,shape:f,description:x.sanitizeText(t,b()),classes:`${_} ${ut}`});let s=C[t];o.description&&(Array.isArray(s.description)?(s.shape=L,s.description.push(o.description)):s.description.length>0?(s.shape=L,s.description===t?s.description=[o.description]:s.description=[s.description,o.description]):(s.shape=R,s.description=o.description),s.description=x.sanitizeTextOrArray(s.description,b())),s.description.length===1&&s.shape===L&&(s.shape=R),!s.type&&o.doc&&(d.info("Setting cluster for ",t,P(o)),s.type="group",s.dir=P(o),s.shape=o.type===Q?Et:pt,s.classes=s.classes+" "+gt+" "+(c?xt:""));let T={labelStyle:"",shape:s.shape,labelText:s.description,classes:s.classes,style:"",id:t,dir:s.dir,domId:m(t,E),type:s.type,padding:15};if(T.centerLabel=!0,o.note){let p={labelStyle:"",shape:St,labelText:o.note.text,classes:bt,style:"",id:t+Ct+"-"+E,domId:m(t,E,et),type:s.type,padding:15},g={labelStyle:"",shape:ft,labelText:o.note.text,classes:s.classes,style:"",id:t+Z,domId:m(t,E,tt),type:"group",padding:0},l=t+Z;e.setNode(l,g),e.setNode(p.id,p),e.setNode(t,T),e.setParent(t,l),e.setParent(p.id,l);let D=t,S=p.id;o.note.position==="left of"&&(D=p.id,S=t),e.setEdge(D,S,{arrowhead:"none",arrowType:"",style:ot,labelStyle:"",id:w(D,S,{counter:E}),classes:At,arrowheadStyle:st,labelpos:nt,labelType:it,thickness:rt}),E++}else e.setNode(t,T)}n&&n.id!=="root"&&(d.trace("Setting node ",t," to be child of its parent ",n.id),e.setParent(t,n.id)),o.doc&&(d.trace("Adding nodes children "),Lt(e,o,o.doc,i,r,!c))},"setupNode"),Lt=a((e,n,o,i,r,c)=>{d.trace("items",o),o.forEach(t=>{switch(t.stmt){case F:h(e,n,t,i,r,c);break;case G:h(e,n,t,i,r,c);break;case J:{h(e,n,t.state1,i,r,c),h(e,n,t.state2,i,r,c);let _={id:w(t.state1.id,t.state2.id,{counter:E}),arrowhead:"normal",arrowTypeEnd:"arrow_barb",style:ot,labelStyle:"",label:x.sanitizeText(t.description,b()),arrowheadStyle:st,labelpos:nt,labelType:it,thickness:rt,classes:I};e.setEdge(t.state1.id,t.state2.id,_,E),E++}break}})},"setupDoc"),P=a((e,n=K)=>{let o=n;if(e.doc)for(let i=0;i<e.doc.length;i++){let r=e.doc[i];r.stmt==="dir"&&(o=r.value)}return o},"getDir"),mt=a(async function(e,n,o,i){d.info("Drawing state diagram (v2)",n),C={};let r=i.db.getDirection();r===void 0&&(r=q);let{securityLevel:c,state:t}=b(),_=t.nodeSpacing||50,f=t.rankSpacing||50;d.info(i.db.getRootDocV2()),i.db.extract(i.db.getRootDocV2()),d.info(i.db.getRootDocV2());let s=i.db.getStates(),T=new W({multigraph:!0,compound:!0}).setGraph({rankdir:P(i.db.getRootDocV2()),nodesep:_,ranksep:f,marginx:8,marginy:8}).setDefaultEdgeLabel(function(){return{}});h(T,void 0,i.db.getRootDocV2(),s,i.db,!0);let p;c==="sandbox"&&(p=y("#i"+n));let g=c==="sandbox"?y(p.nodes()[0].contentDocument.body):y("body"),l=g.select(`[id="${n}"]`),D=g.select("#"+n+" g");await z(D,T,["barb"],u,n);let S=8;V.insertTitle(l,"statediagramTitleText",t.titleTopMargin,i.db.getDiagramTitle());let k=l.node().getBBox(),M=k.width+S*2,B=k.height+S*2;l.attr("class",u);let v=l.node().getBBox();Y(l,B,M,t.useMaxWidth);let H=`${v.x-S} ${v.y-S} ${M} ${B}`;d.debug(`viewBox ${H}`),l.attr("viewBox",H);let lt=document.querySelectorAll('[id="'+n+'"] .edgeLabel .label');for(let $ of lt){let U=$.getBBox(),A=document.createElementNS("http://www.w3.org/2000/svg",R);A.setAttribute("rx",0),A.setAttribute("ry",0),A.setAttribute("width",U.width),A.setAttribute("height",U.height),$.insertBefore(A,$.firstChild)}},"draw"),ct={setConf:wt,getClasses:Gt,draw:mt};var Ft={parser:j,db:N,renderer:ct,styles:X,init:e=>{e.state||(e.state={}),e.state.arrowMarkerAbsolute=e.arrowMarkerAbsolute,N.clear()}};export{Ft as diagram};
